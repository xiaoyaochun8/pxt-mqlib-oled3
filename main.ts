/**
 * mqOled blocks
 */
//% groups=['oled-汉字库']
namespace mqlib{
    let arrWordBank = [
/* 0 已 */[0x00, 0x00, 0xe2, 0x82, 0x82, 0x82, 0x82, 0x82, 0x82, 0x82, 0x82, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3f, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x78, 0x00, 0x00,],
/* 1 到 */[0x42, 0x62, 0x52, 0x4a, 0xc6, 0x42, 0x52, 0x62, 0xc2, 0x00, 0xf8, 0x00, 0x00, 0xff, 0x00, 0x00, 0x40, 0xc4, 0x44, 0x44, 0x7f, 0x24, 0x24, 0x24, 0x20, 0x00, 0x0f, 0x40, 0x80, 0x7f, 0x00, 0x00,],
/* 2 站 */[0x00, 0xc8, 0x08, 0x09, 0x0e, 0xe8, 0x08, 0x00, 0x00, 0x00, 0xff, 0x10, 0x10, 0x10, 0x10, 0x00, 0x10, 0x30, 0x17, 0x10, 0x0e, 0x09, 0x08, 0xff, 0x41, 0x41, 0x41, 0x41, 0x41, 0xff, 0x00, 0x00,],
/* 3 ： */[0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,],
/* 4 客 */[0x10, 0x0c, 0x84, 0x44, 0xb4, 0xa4, 0x25, 0x26, 0x24, 0xa4, 0x64, 0x24, 0x04, 0x14, 0x0c, 0x00, 0x04, 0x04, 0x04, 0xfa, 0x4a, 0x4a, 0x49, 0x49, 0x49, 0x4a, 0x4a, 0xfa, 0x04, 0x04, 0x04, 0x00,],
/* 5 厅 */[0x00, 0x00, 0xfe, 0x02, 0x22, 0x22, 0x22, 0x22, 0x22, 0xe2, 0x22, 0x22, 0x22, 0x22, 0x22, 0x00, 0x80, 0x60, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x40, 0x80, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,],
/* 6 姥 */[0x10, 0x10, 0xf0, 0x1f, 0x10, 0xf0, 0x40, 0x48, 0x48, 0xff, 0x48, 0x68, 0x50, 0x4c, 0x40, 0x00, 0x40, 0x22, 0x15, 0x08, 0x16, 0x61, 0x04, 0x02, 0x3f, 0x48, 0x48, 0x44, 0x44, 0x42, 0x70, 0x00,],
/* 7 屋 */[0x00, 0x00, 0xfe, 0x12, 0x52, 0x52, 0x52, 0xd2, 0x52, 0x52, 0x52, 0x52, 0x52, 0x5e, 0x00, 0x00, 0x80, 0x60, 0x9f, 0x80, 0x90, 0x92, 0x93, 0x92, 0xfe, 0x92, 0x92, 0x93, 0x96, 0x90, 0x80, 0x00,],
/* 8 厨 */[0x00, 0x00, 0xfe, 0x0a, 0xea, 0x2a, 0x2a, 0xea, 0x0a, 0x42, 0x42, 0x42, 0xfe, 0x42, 0x42, 0x00, 0x80, 0x60, 0x1f, 0x40, 0xcb, 0x52, 0x32, 0x2b, 0x20, 0x02, 0x44, 0x80, 0x7f, 0x00, 0x00, 0x00,],
/* 9 房 */[0x00, 0x00, 0xfc, 0x24, 0x24, 0x24, 0x25, 0x66, 0xa4, 0x24, 0x24, 0x24, 0x24, 0x3c, 0x00, 0x00, 0x40, 0x30, 0x0f, 0x81, 0x41, 0x31, 0x0f, 0x09, 0x09, 0x09, 0x49, 0x89, 0x79, 0x01, 0x00, 0x00,],
/* 10 餐 */[0x90, 0x88, 0x5c, 0x68, 0xcf, 0xaa, 0x6a, 0xba, 0x40, 0xc2, 0xaa, 0x12, 0x2e, 0x40, 0x00, 0x00, 0x02, 0x02, 0x01, 0x01, 0xff, 0x95, 0x55, 0x15, 0x35, 0x35, 0x5f, 0x61, 0x91, 0x02, 0x02, 0x00,],
/* 11 桌 */[0x00, 0x00, 0x00, 0xf0, 0x50, 0x50, 0x50, 0x5f, 0x54, 0x54, 0x54, 0x54, 0xf4, 0x04, 0x00, 0x00, 0x44, 0x44, 0x24, 0x25, 0x15, 0x0d, 0x05, 0xff, 0x05, 0x0d, 0x15, 0x25, 0x25, 0x44, 0x44, 0x00,],
/* 12 卫 */[0x00, 0x02, 0x02, 0x02, 0x02, 0x02, 0xfe, 0x02, 0x02, 0x02, 0x02, 0x02, 0xfe, 0x00, 0x00, 0x00, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x7f, 0x40, 0x40, 0x40, 0x41, 0x42, 0x41, 0x40, 0x40, 0x00,],
/* 13 生 */[0x80, 0x40, 0x30, 0x1e, 0x10, 0x10, 0x10, 0xff, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x00, 0x00, 0x40, 0x40, 0x42, 0x42, 0x42, 0x42, 0x42, 0x7f, 0x42, 0x42, 0x42, 0x42, 0x42, 0x40, 0x40, 0x00,],
/* 14 间 */[0x00, 0xf8, 0x01, 0x06, 0x00, 0xf0, 0x12, 0x12, 0x12, 0xf2, 0x02, 0x02, 0x02, 0xfe, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x1f, 0x11, 0x11, 0x11, 0x1f, 0x00, 0x40, 0x80, 0x7f, 0x00, 0x00,],
/* 15 书 */[0x00, 0x00, 0x08, 0x08, 0x08, 0x08, 0xff, 0x08, 0x08, 0x08, 0xf9, 0x02, 0x04, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0xff, 0x01, 0x01, 0x01, 0x21, 0x41, 0x21, 0x1f, 0x00, 0x00,],
/* 16 卧 */[0x00, 0xfe, 0x22, 0x22, 0x3e, 0x22, 0x22, 0xe2, 0x02, 0x00, 0xff, 0x20, 0x40, 0x80, 0x00, 0x00, 0x00, 0x3f, 0x22, 0x22, 0x3e, 0x22, 0x22, 0x23, 0x20, 0x00, 0xff, 0x00, 0x00, 0x00, 0x03, 0x00,],
/* 17 室 */[0x10, 0x0c, 0x24, 0x24, 0xa4, 0x64, 0x25, 0x26, 0x24, 0x24, 0xa4, 0x24, 0x24, 0x14, 0x0c, 0x00, 0x40, 0x40, 0x48, 0x49, 0x49, 0x49, 0x49, 0x7f, 0x49, 0x49, 0x49, 0x4b, 0x48, 0x40, 0x40, 0x00,]
    ];
    let screen1024 = pins.createBuffer(1024);
    let _screen1025 = pins.createBuffer(1025);
    function getWordsIndex(str: string){
        let strMap = '静夜思床前明月光，疑似地上霜。举头望低故乡';
        let arrMap = strMap.split('');
        let arrStr = str.split('');
        let arrIndex:string[] = [];
        // for (let i of arrStr) {
        //     for (let im of arrMap) {
        //         if (arrMap[parseInt(im)] == arrStr[parseInt(i)]) {
        //             arrIndex.push(im);
        //         }
        //     }
        // }
        // arrStr.forEach((val:string, idx:number, arrStr:Array) => {
        //     arrMap.forEach((val2, idx2, arr2) => {
        //         if (val2 == val) {
        //             arrIndex.push(idx2);
        //         }
        //     });
        // });
        return arrIndex;
    }
    /*
arr 字符串
posX 列，1~128
posY 行，1~4
*/
    function showWords2(arr: string[], posX = 1, posY = 1) {
        let line:number = 0;
        for (let ci of arr) {
            line = Math.floor(parseInt(ci) / 8);
            let iWordBankIndex = parseInt(arr[parseInt(ci)]);
            // let cnt = arrWordBank[iWordBankIndex].length;
            let index = 0;
            for (let i = 0; i < 16; i++) {
                index = i;
                //字符换行，8字符
                index += 128 * line;
                //字模偏移，16x16
                index += parseInt(ci) * 16;
                //列偏移，128列
                index += (posX - 1) % 128;
                //行偏移，4行
                index += (posY - 1) * 256;
                //上半
                screen1024[index] = arrWordBank[iWordBankIndex][i];
                //下半
                screen1024[index + 128] = arrWordBank[iWordBankIndex][i + 16];
            }
        }
    }
    //% subcategory="oled"
    //% group='oled-汉字库'
    //% block="已到站：卧室"
    export function TestShowWords7() {
        let arrIndex = ['0', '1', '2', '3', '16', '17'];
        doShowWords(arrIndex);
    }
    //% subcategory="oled"
    //% group='oled-汉字库'
    //% block="已到站：书房"
    export function TestShowWords6() {
        let arrIndex = ['0', '1', '2', '3', '15', '9'];
        doShowWords(arrIndex);
    }
    //% subcategory="oled"
    //% group='oled-汉字库'
    //% block="已到站：卫生间"
    export function TestShowWords5() {
        let arrIndex = ['0', '1', '2', '3', '12', '13', '14'];
        doShowWords(arrIndex);
    }
    //% subcategory="oled"
    //% group='oled-汉字库'
    //% block="已到站：餐桌"
    export function TestShowWords4() {
        let arrIndex = ['0', '1', '2', '3', '10', '11'];
        doShowWords(arrIndex);
    }
    //% subcategory="oled"
    //% group='oled-汉字库'
    //% block="已到站：厨房"
    export function TestShowWords3() {
        let arrIndex = ['0', '1', '2', '3', '8', '9'];
        doShowWords(arrIndex);
    }
    //% subcategory="oled"
    //% group='oled-汉字库'
    //% block="已到站：姥姥屋"
    export function TestShowWords2(){
        let arrIndex = ['0', '1', '2', '3', '6', '6', '7'];
        doShowWords(arrIndex);
    }
    //% subcategory="oled"
    //% group='oled-汉字库'
    //% block="已到站：客厅"
    export function TestShowWords() {
        let arrIndex = ['0', '1', '2', '3', '4', '5'];
        doShowWords(arrIndex);
    }
    function doShowWords(arrIndex: string[]) {
        screen1024.fill(0);
        showWords2(arrIndex);
        _screen1025.fill(0);
        _screen1025[0] = 0x40; //64
        for (let i = 0; i < 1024; i++) {
            _screen1025[i + 1] = screen1024[i];
        }
        pins.i2cWriteBuffer(60, _screen1025);
        //mqlib.drawPicBy1024Hex(screen1024);
    }
}